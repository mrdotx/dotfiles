# path:       /home/klassiker/.config/i3/config
# author:     klassiker [mrdotx]
# github:     https://github.com/mrdotx/dotfiles
# date:       2020-12-27T11:23:20+0100

# general
#########

# variables
set $sup Mod4
set $alt Mod1
set $mon1 eDP1
set $mon2 HDMI2
set $size resize set 1280 800
set $float floating enable
set $sticky sticky enable
set $border border pixel 2
set $move move position center
set $gapin 5
set $gapout 5

# config
floating_modifier $sup
focus_follows_mouse no
mouse_warping none
font pango:DejaVu Sans 10
default_$border
default_floating_border normal
gaps inner $gapin
gaps outer $gapout
smart_gaps on
smart_borders on

# colors
set_from_resource $black0   i3wm.color0     #000000
set_from_resource $grey0    i3wm.color8     #333333
set_from_resource $red0     i3wm.color1     #df2800
set_from_resource $red1     i3wm.color9     #ff5555
set_from_resource $green0   i3wm.color2     #00b200
set_from_resource $green1   i3wm.color10    #39ff14
set_from_resource $yellow0  i3wm.color3     #b0b200
set_from_resource $yellow1  i3wm.color11    #effd5f
set_from_resource $blue0    i3wm.color4     #1f5393
set_from_resource $blue1    i3wm.color12    #4185d7
set_from_resource $purple0  i3wm.color5     #980096
set_from_resource $purple1  i3wm.color13    #ff6fff
set_from_resource $cyan0    i3wm.color6     #008081
set_from_resource $cyan1    i3wm.color14    #7ef9ff
set_from_resource $grey1    i3wm.color7     #cccccc
set_from_resource $white0   i3wm.color15    #ffffff

# class                 border   backgr.  text     indi.    child
client.focused          $blue1   $blue0   $white0  $white0  $blue1
client.focused_inactive $grey0   $grey0   $white0  $grey0   $grey0
client.unfocused        $grey0   $black0  $grey0   $grey0   $black0
client.urgent           $grey0   $red1    $white0  $red1    $red1
client.placeholder      $black0  $grey0   $white0  $black0  $grey0
client.background       $white0

# workspace
###########

# workspace names
set $ws1 1
set $ws2 2
set $ws3 3
set $ws4 4
set $ws5 5
set $ws6 6
set $ws7 7
set $ws8 8
set $ws9 9
set $ws0 10

# workspace output
workspace $ws1 output $mon1 $mon2
workspace $ws2 output $mon2 $mon1
workspace $ws3 output $mon2 $mon1
workspace $ws4 output $mon2 $mon1
workspace $ws5 output $mon1 $mon2
workspace $ws6 output $mon2 $mon1
workspace $ws7 output $mon1 $mon2
workspace $ws8 output $mon1 $mon2
workspace $ws9 output $mon1 $mon2
workspace $ws0 output $mon2 $mon1

# keybindings workspace
#######################

# switch to workspace
bindsym $sup+1 workspace $ws1
bindsym $sup+2 workspace $ws2
bindsym $sup+3 workspace $ws3
bindsym $sup+4 workspace $ws4
bindsym $sup+5 workspace $ws5
bindsym $sup+6 workspace $ws6
bindsym $sup+7 workspace $ws7
bindsym $sup+8 workspace $ws8
bindsym $sup+9 workspace $ws9
bindsym $sup+0 workspace $ws0

# move focused container to workspace
bindsym $sup+Ctrl+1 move container to workspace $ws1
bindsym $sup+Ctrl+2 move container to workspace $ws2
bindsym $sup+Ctrl+3 move container to workspace $ws3
bindsym $sup+Ctrl+4 move container to workspace $ws4
bindsym $sup+Ctrl+5 move container to workspace $ws5
bindsym $sup+Ctrl+6 move container to workspace $ws6
bindsym $sup+Ctrl+7 move container to workspace $ws7
bindsym $sup+Ctrl+8 move container to workspace $ws8
bindsym $sup+Ctrl+9 move container to workspace $ws9
bindsym $sup+Ctrl+0 move container to workspace $ws0

# move to workspace with focused container
bindsym $sup+Shift+1 move container to workspace $ws1; workspace $ws1
bindsym $sup+Shift+2 move container to workspace $ws2; workspace $ws2
bindsym $sup+Shift+3 move container to workspace $ws3; workspace $ws3
bindsym $sup+Shift+4 move container to workspace $ws4; workspace $ws4
bindsym $sup+Shift+5 move container to workspace $ws5; workspace $ws5
bindsym $sup+Shift+6 move container to workspace $ws6; workspace $ws6
bindsym $sup+Shift+7 move container to workspace $ws7; workspace $ws7
bindsym $sup+Shift+8 move container to workspace $ws8; workspace $ws8
bindsym $sup+Shift+9 move container to workspace $ws9; workspace $ws9
bindsym $sup+Shift+0 move container to workspace $ws0; workspace $ws0

# workspace back and forth
bindsym $alt+Tab workspace back_and_forth

# navigate workspaces next/previous
bindsym $sup+Ctrl+Left workspace prev
bindsym $sup+Ctrl+Right workspace next

# keybindings window
####################

# change focus
bindsym $sup+Left focus left
bindsym $sup+Right focus right
bindsym $sup+Up focus up
bindsym $sup+Down focus down

# move focused window
bindsym $sup+Shift+Left move left 20 px
bindsym $sup+Shift+Right move right 20 px
bindsym $sup+Shift+Up move up 20 px
bindsym $sup+Shift+Down move down 20 px

# swap workspaces
bindsym $sup+Home exec --no-startup-id "i3_workspace_swap.sh left"
bindsym $sup+End exec --no-startup-id "i3_workspace_swap.sh right"
bindsym $sup+Prior exec --no-startup-id "i3_workspace_swap.sh up"
bindsym $sup+Next exec --no-startup-id "i3_workspace_swap.sh down"

# window switcher
bindsym $sup+Tab exec --no-startup-id "dmenu_windows.sh"

# change focus between tiling/floating windows
bindsym $sup+semicolon focus mode_toggle

# toggle window tiling/floating
bindsym $sup+apostrophe floating toggle

# keybindings container
#######################

bindsym $sup+space mode "container"; \
    exec --no-startup-id "i3_container.sh"
mode "container" {
    # resize container
    bindsym Left resize shrink width 20 px or 5 ppt
    bindsym Right resize grow width 20 px or 5 ppt
    bindsym Up resize shrink height 20 px or 5 ppt
    bindsym Down resize grow height 20 px or 5 ppt

    # resize gaps
    bindsym minus gaps inner current minus $gapin
    bindsym shift+equal gaps inner current plus $gapin
    bindsym equal gaps inner current set $gapin

    # toggle sticky
    bindsym s sticky toggle; \
        exec --no-startup-id "notify-send 'i3 container mode' 'toggle sticky'"

    # move the currently focused window to the scratchpad
    bindsym m move scratchpad; \
        exec --no-startup-id "notify-send 'i3 container mode' 'move to scratchpad'"

    # Show the next scratchpad window or hide the focused scratchpad window.
    # If there are multiple scratchpad windows, this command cycles through them.
    bindsym c scratchpad show; \
        exec --no-startup-id "notify-send 'i3 container mode' 'cycle scratchpad'"

    # split orientation
    bindsym h split horizontal; \
        exec --no-startup-id "notify-send 'i3 container mode' 'tile horizontal'"
    bindsym v split vertical; \
        exec --no-startup-id "notify-send 'i3 container mode' 'tile vertical'"

    # back to default mode
    bindsym q mode "default"; \
        exec --no-startup-id "i3_container.sh --kill"
    bindsym Return mode "default"; \
        exec --no-startup-id "i3_container.sh --kill"
    bindsym Escape mode "default"; \
        exec --no-startup-id "i3_container.sh --kill"
    bindsym $sup+space mode "default"; \
        exec --no-startup-id "i3_container.sh --kill"
}

# application windows (xprop)
#############################

# center
for_window [title="LibreOffice"] $move

# floating applications
for_window [title="floating"] $float, $size, $move

for_window [title="^alsamixer$"] $float, $move
for_window [title="^calculator$"] $float, $size, $move
for_window [title="^cdw$"] $float, $size, $move
for_window [title="^stopwatch$"] $float, resize set 250 500, $move

for_window [class="^KeePassXC$"] $float, $sticky, move scratchpad, scratchpad show, $size, $move
for_window [class="^Dragon-drag-and-drop$"] $float, $sticky, $border, $move
for_window [class="^Lxappearance$"] $float, $sticky, $move
for_window [class="^Gufw.py$"] $float, $sticky, resize set 500 800, $move
for_window [class="^qt5ct$"] $float, $sticky, $move
for_window [class="^Pamac-manager$"] $float, $border, $move
for_window [class="^GParted$"] $float, $size, $move
for_window [class="^Manjaro Settings Manager$"] $float, $move
for_window [class="^gmic_qt$"] $float, $move
for_window [class="^qv4l2$"] $float, $move
for_window [class="^Sxiv$"] $float, $size, $move
for_window [class="^mpv$"] $float, $sticky

# open applications on specific workspaces
assign [title="^i3 tmux$"] $ws3
assign [class="^firefoxdeveloperedition$"] $ws4
assign [class="^Gimp$"] $ws5
assign [class="^Inkscape$"] $ws5
assign [class="^Darktable$"] $ws5
assign [title="^LibreOffice$"] $ws6
assign [class="libreoffice"] $ws6
assign [class="^scribus$"] $ws6
assign [class="^Thunderbird$"] $ws7
assign [class="^Jameica"] $ws8
assign [class="^VirtualBox"] $ws9
assign [class="^Kodi$"] $ws0
assign [class="^Minetest$"] $ws0

# keybindings system managment
##############################

# start program launcher
bindsym Super_L --release exec --no-startup-id "i3-dmenu-desktop --dmenu='dmenu -i'"
bindsym Shift+Super_L --release exec --no-startup-id "dmenu_run -i"

# kill focused window
bindsym Ctrl+q kill

# x window kill
bindsym Ctrl+$alt+BackSpace --release exec --no-startup-id "xkill"

# toggle fullscreen mode for the focused container or global
bindsym $sup+f fullscreen toggle
bindsym $sup+Shift+f fullscreen toggle global

# Lock screen or suspend (sleep -> https://github.com/i3/i3/issues/3298)
bindsym $sup+l exec --no-startup-id "sleep 0.5 && i3_exit.sh --lock simple"
bindsym $sup+Shift+l exec --no-startup-id "sleep 0.5 && i3_exit.sh --suspend"

# restart i3 inplace (preserves your layout/session, can be used to upgrade i3)
bindsym $sup+Shift+r restart

# keybindings exit
##################

bindsym Ctrl+$alt+Delete mode "exit"; \
    exec --no-startup-id "i3_exit.sh"
mode "exit" {
    # lock blur
    bindsym c exec --no-startup-id "i3_exit.sh --lock blur"; \
        mode "default"; \
        exec --no-startup-id "i3_exit.sh --kill"

    # shutdown
    bindsym d exec --no-startup-id "i3_exit.sh --shutdown"; \
        mode "default"; \
        exec --no-startup-id "i3_exit.sh --kill"

    # logout
    bindsym l exec --no-startup-id "i3_exit.sh --logout"; \
        mode "default"; \
        exec --no-startup-id "i3_exit.sh --kill"

    # lock simple
    bindsym o exec --no-startup-id "i3_exit.sh --lock simple"; \
        mode "default"; \
        exec --no-startup-id "i3_exit.sh --kill"

    # suspend blur
    bindsym p exec --no-startup-id "i3_exit.sh --suspend blur"; \
        mode "default"; \
        exec --no-startup-id "i3_exit.sh --kill"

    # reboot
    bindsym r exec --no-startup-id "i3_exit.sh --reboot"; \
        mode "default"; \
        exec --no-startup-id "i3_exit.sh --kill"

    # suspend
    bindsym s exec --no-startup-id "i3_exit.sh --suspend"; \
        mode "default"; \
        exec --no-startup-id "i3_exit.sh --kill"

    # suspend simple
    bindsym u exec --no-startup-id "i3_exit.sh --suspend simple"; \
        mode "default"; \
        exec --no-startup-id "i3_exit.sh --kill"

    # back to default mode
    bindsym q mode "default"; \
        exec --no-startup-id "i3_exit.sh --kill"
    bindsym Return mode "default"; \
        exec --no-startup-id "i3_exit.sh --kill"
    bindsym Escape mode "default"; \
        exec --no-startup-id "i3_exit.sh --kill"
    bindsym Ctrl+$alt+Delete mode "default"; \
        exec --no-startup-id "i3_exit.sh --kill"
}

# keybindings services
######################

bindsym $alt+space mode "services"; \
    exec --no-startup-id "i3_services.sh"
mode "services" {
    # bluetooth disable/enable
    bindsym b exec --no-startup-id "i3_services.sh --bluetooth"

    # compositor disable/enable
    bindsym c exec --no-startup-id "i3_services.sh --compositor"

    # dunst restart
    bindsym d exec --no-startup-id "killall dunst; notify-send 'i3' 'restart dunst'; i3_services.sh"

    # firewall disable/enable
    bindsym f exec --no-startup-id "i3_services.sh --firewall"

    # gestures disable/enable
    bindsym g exec --no-startup-id "i3_services.sh --gestures"

    # autolock disable/enable
    bindsym l exec --no-startup-id "i3_services.sh --autolock"

    # mousepointer disable/enable
    bindsym m exec --no-startup-id "i3_services.sh --mousepointer"

    # printer disable/enable
    bindsym p exec --no-startup-id "i3_services.sh --printer"

    # rss disable/enable
    bindsym r exec --no-startup-id "i3_services.sh --rss"

    # resolver disable/enable
    bindsym s exec --no-startup-id "i3_services.sh --resolver"

    # tiling disable/enable
    bindsym t exec --no-startup-id "i3_services.sh --tiling"

    # vpn disable/enable
    bindsym v exec --no-startup-id "i3_services.sh --vpn"

    # timesync disable/enable
    bindsym y exec --no-startup-id "i3_services.sh --timesync"

    # back to default mode
    bindsym q mode "default"; \
        exec --no-startup-id "i3_services.sh --kill"
    bindsym Return mode "default"; \
        exec --no-startup-id "i3_services.sh --kill"
    bindsym Escape mode "default"; \
        exec --no-startup-id "i3_services.sh --kill"
    bindsym $alt+space mode "default"; \
        exec --no-startup-id "i3_services.sh --kill"
}

# keybindings xf86 keys
#######################

bindsym XF86AudioRaiseVolume exec --no-startup-id "audio.sh -inc 5"
bindsym XF86AudioLowerVolume exec --no-startup-id "audio.sh -dec 5"
bindsym XF86AudioMute exec --no-startup-id "audio.sh -mute"
bindsym XF86MonBrightnessUp exec --no-startup-id "doas backlight.sh -inc 5"
bindsym XF86MonBrightnessDown exec --no-startup-id "doas backlight.sh -dec 5"
bindsym XF86Cut exec --no-startup-id "polybar.sh -r"
bindsym $sup+p exec --no-startup-id "dmenu_display.sh"

# keybindings screenshot
########################

bindsym Print --release exec --no-startup-id "screenshot.sh -desk"
bindsym $sup+Print --release exec --no-startup-id "screenshot.sh -window"
bindsym $sup+Shift+Print --release exec --no-startup-id "screenshot.sh -select"

# keybindings applications
##########################

bindsym $sup+Return exec --no-startup-id "$TERMINAL"
bindsym $sup+Shift+Return exec --no-startup-id "$TERMINAL2"

bindsym $sup+a exec --no-startup-id "$TERMINAL -e alsamixer"
bindsym $sup+b exec --no-startup-id "dmenu_bookmarks.sh"
bindsym $sup+c exec --no-startup-id "i3_tmux.sh -o 5 'cmus' 'cmus && polybar-msg hook module/music 1'" workspace $ws3
bindsym $sup+Shift+c exec --no-startup-id "polybar_music.sh --notify"
bindsym $sup+d exec "darktable" workspace $ws5
bindsym $sup+e exec --no-startup-id "dmenu_vim.sh"
bindsym $sup+g exec "gimp" workspace $ws5
bindsym $sup+i exec "inkscape" workspace $ws5
bindsym $sup+h exec --no-startup-id "i3_tmux.sh -o 8 'hermes' 'ssh hermes'" workspace $ws3
bindsym $sup+Shift+h exec --no-startup-id "i3_tmux.sh -o 9 'prometheus' 'ssh prometheus'" workspace $ws3
bindsym $sup+j exec "jameica" workspace $ws8
bindsym $sup+k exec --no-startup-id "if pgrep -x keepassxc; then i3-msg [class='^KeePassXC$'] scratchpad show; else sync_keepass.sh && keepassxc && sync_keepass.sh; fi"
bindsym $sup+Shift+k exec --no-startup-id "kodi" workspace $ws10
bindsym $sup+m exec "thunderbird" workspace $ws7
bindsym $sup+Shift+m exec "minetest --logfile ''" workspace $ws10
bindsym $sup+n exec --no-startup-id "i3_tmux.sh -o 3 'newsboat' 'polybar_rss.sh --open'" workspace $ws3
bindsym $sup+Shift+n exec --no-startup-id "i3_tmux.sh -o 4 'podboat'" workspace $ws3
bindsym $sup+o exec "libreoffice" workspace $ws6
bindsym $sup+r exec --no-startup-id "i3_tmux.sh -o 2 $FILE" workspace $ws3
bindsym $sup+s exec "scribus" workspace $ws6
bindsym $sup+t exec --no-startup-id "i3_tmux.sh -o 6 'htop'" workspace $ws3
bindsym $sup+Shift+t exec --no-startup-id "i3_tmux.sh -o 7 'bpytop'" workspace $ws3
bindsym $sup+u exec --no-startup-id "dmenu_mount.sh"
bindsym $sup+v exec --no-startup-id "dmenu_virtualbox.sh"
bindsym $sup+w exec --no-startup-id "if pgrep -x 'firefox'; then firefox-developer-edition --new-tab --url about:newtab; else firefox-developer-edition; fi" workspace $ws4
bindsym $sup+Shift+w exec --no-startup-id "$BROWSER"
bindsym $sup+x exec --no-startup-id "link_handler.sh $(dragon-drag-and-drop -t -x)"
bindsym $sup+y exec --no-startup-id "dmenu_youtube.sh"
bindsym $sup+z exec --no-startup-id "filezilla"

bindsym $sup+grave exec --no-startup-id "dmenu_unicode_symbols.sh"
bindsym $sup+bracketleft exec --no-startup-id "i3_tmux.sh -o 10 'man' 'fzf_man.sh'" workspace $ws3
bindsym $sup+bracketright exec --no-startup-id "i3_tmux.sh -o 11 'aur' 'fzf_pacman.sh'" workspace $ws3
bindsym $sup+backslash exec --no-startup-id "sleep 0.5 && chameleon.sh"
bindsym $sup+Shift+backslash exec --no-startup-id "conky.sh"
bindsym $sup+comma exec --no-startup-id "dmenu_calc.sh"
bindsym $sup+period exec --no-startup-id "$TERMINAL -T 'stopwatch' -e stopwatch.sh"
bindsym $sup+slash exec --no-startup-id "$TERMINAL -T 'shortcuts' -e w3m $HOME/Dokumente/Notes/html/shortcuts.html"
bindsym $sup+Shift+slash exec --no-startup-id "$TERMINAL -T 'notes' -e w3m $HOME/Dokumente/Notes/html/index.html"

# i3 status bar
###############

# bar {
#     id bar-0
#     position top
#     height 27
#     status_command i3status --config ~/.config/i3status/config_pmon
#     i3bar_command i3bar --transparency
#     output eDP1
#     tray_output eDP1
#     tray_padding 2
#     font pango:DejaVu Sans 10
#     separator_symbol " "
#     colors {
#         background #00000000
#         statusline $white0
#         separator  $grey1

#         focused_workspace  $blue0  $blue1  $white0
#         active_workspace   $white0 $grey0  $white0
#         inactive_workspace $grey0  $black0 $white
#         urgent_workspace   $grey0  $red1   $white0
#         binding_mode       $grey0  $red1   $white0
#     }
# }

# bar {
#     id bar-1
#     position top
#     height 27
#     status_command i3status --config ~/.config/i3status/config_smon
#     i3bar_command i3bar --transparency
#     output HDMI2
#     tray_output none
#     tray_padding 2
#     font pango:DejaVu Sans 10
#     separator_symbol " "
#     colors {
#         background #00000000
#         statusline $white0
#         separator  $grey1

#         focused_workspace  $blue0  $blue1  $white0
#         active_workspace   $white0 $grey0  $white0
#         inactive_workspace $grey0  $black0 $white
#         urgent_workspace   $grey0  $red1   $white0
#         binding_mode       $grey0  $red1   $white0
#     }
# }

# start systemd target
######################

exec --no-startup-id "systemctl --user start i3.target"
